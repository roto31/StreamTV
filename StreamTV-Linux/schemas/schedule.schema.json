{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Schedule Configuration Schema (ErsatzTV-compatible)",
  "description": "JSON schema for validating schedule YAML files compatible with ErsatzTV format",
  "type": "object",
  "required": ["name", "content", "sequence", "playout"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Schedule name"
    },
    "description": {
      "type": "string",
      "description": "Schedule description"
    },
    "import": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of YAML files to import"
    },
    "content": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["key", "collection"],
        "properties": {
          "key": {
            "type": "string",
            "description": "Unique content key"
          },
          "collection": {
            "type": "string",
            "description": "Collection name"
          },
          "order": {
            "type": "string",
            "enum": ["chronological", "shuffle", "random"],
            "default": "chronological",
            "description": "Playback order"
          }
        }
      }
    },
    "sequence": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["key", "items"],
        "properties": {
          "key": {
            "type": "string",
            "description": "Unique sequence key"
          },
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "anyOf": [
                {
                  "properties": {
                    "duration": {
                      "type": "string",
                      "pattern": "^\\d{2}:\\d{2}:\\d{2}$",
                      "description": "Duration in HH:MM:SS format"
                    },
                    "content": {
                      "type": "string"
                    },
                    "filler_kind": {
                      "type": "string"
                    },
                    "trim": {
                      "type": "boolean"
                    },
                    "discard_attempts": {
                      "type": "integer",
                      "minimum": 0
                    }
                  },
                  "required": ["duration", "content"]
                },
                {
                  "properties": {
                    "all": {
                      "type": "string"
                    },
                    "custom_title": {
                      "type": "string"
                    },
                    "filler_kind": {
                      "type": "string"
                    }
                  },
                  "required": ["all"]
                },
                {
                  "properties": {
                    "sequence": {
                      "type": "string"
                    },
                    "pre_roll": {
                      "type": "boolean"
                    },
                    "mid_roll": {
                      "type": "boolean"
                    },
                    "post_roll": {
                      "type": "boolean"
                    },
                    "expression": {
                      "type": "string"
                    }
                  }
                },
                {
                  "properties": {
                    "padToNext": {
                      "type": "integer",
                      "minimum": 1
                    },
                    "content": {
                      "type": "string"
                    },
                    "fallback": {
                      "type": "string"
                    }
                  }
                },
                {
                  "properties": {
                    "padUntil": {
                      "type": "string",
                      "pattern": "^\\d{2}:\\d{2}(:\\d{2})?$"
                    },
                    "content": {
                      "type": "string"
                    }
                  }
                },
                {
                  "properties": {
                    "waitUntil": {
                      "type": "string",
                      "pattern": "^\\d{2}:\\d{2}(:\\d{2})?$"
                    },
                    "tomorrow": {
                      "type": "boolean"
                    },
                    "rewindOnReset": {
                      "type": "boolean"
                    }
                  }
                },
                {
                  "properties": {
                    "skipItems": {
                      "oneOf": [
                        {
                          "type": "integer",
                          "minimum": 0
                        },
                        {
                          "type": "string"
                        }
                      ]
                    },
                    "content": {
                      "type": "string"
                    }
                  }
                },
                {
                  "properties": {
                    "shuffleSequence": {
                      "type": "string"
                    }
                  }
                }
              ]
            }
          }
        }
      }
    },
    "reset": {
      "type": "array",
      "items": {
        "type": "object"
      },
      "description": "Reset instructions (ErsatzTV feature)"
    },
    "playout": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "sequence": {
            "type": "string",
            "description": "Sequence key to play"
          },
          "repeat": {
            "type": "boolean",
            "description": "Whether to repeat the sequence"
          }
        }
      }
    }
  }
}

